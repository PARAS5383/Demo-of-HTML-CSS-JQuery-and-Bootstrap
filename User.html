<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <style>
    .row {
      --bs-gutter-x: 0rem;
    }

    .login-bg {
      background-color: #00000080;
      border-radius: 25px;
    }
  </style>
</head>

<body>
  <div
    style="background-image: url('photos/Header_background.jpg'); height: 100%; min-height: 990px; background-repeat: no-repeat; background-size: cover; background-position: center;">
    <div id="loginId" class="row justify-content-center ">
      <div
        class="login-bg  m-5 col-xxl-5 col-xl-6 col-lg-7 col-md-9 col-sm-10 col-11 align-items-center justify-content-center">
        <h3 class="text-center text-info">User Details</h3>
        <div class="d-flex justify-content-center text-success">
          <p>Your plan:&nbsp;&nbsp;<span id="planId"></span>
            <span id="plandayId"></span>
          </p>
        </div>
        <div class="d-flex justify-content-center text-light">
          <p><strong>Your ID No.:&nbsp;&nbsp;</strong></p>
          <p><strong id="idnoId"></strong></p>
        </div>
        <div class="d-flex justify-content-center text-light">
          <p>Username:&nbsp;&nbsp;</p>
          <p id="usernameId"></p>
        </div>
        <div class="d-flex justify-content-center text-light">
          <p>Name:&nbsp;&nbsp;</p>
          <p id="nameId"></p>
        </div>
        <div class="d-flex justify-content-center text-light">
          <p>Age:&nbsp;&nbsp;</p>
          <p id="ageId"></p>
        </div>
        <div class="d-flex justify-content-center text-light">
          <p>Gender:&nbsp;&nbsp;</p>
          <p id="genderId"></p>
        </div>
        <div class="d-flex justify-content-center text-light">
          <p>Password:&nbsp;&nbsp;</p>
          <p id="passwordId"></p>
        </div>
        <div class="d-flex justify-content-center text-danger" id="notifiactionId">
        </div>
        <div class="d-flex justify-content-center text-info" id="contactId">
        </div>
        <h3 class="text-center mt-2"><button class="btn btn-warning rounded border-0" type="button"
            onclick="editProfile()">Edit Profile</button></h3>
        <h5 class="mt-2 text-center"><a class="text-decoration-none text-success" onclick="backHome()">Home</a></h5>
      </div>
    </div>
    <div id="editId" class="row justify-content-around text-light">
      <div
        class="login-bg m-5 p-3 col-xxl-2 col-xl-3 col-lg-4 col-md-4 col-sm-6 col-11 align-items-center justify-content-center">
        <h3 class="text-center text-info">Edit user details</h3>
        <label for="unameRid">Username<br>
          <input class="form-control mt-1" type="text" id="unameEid" required /></label><br>
        <label for="snameRid">Studentname<br>
          <input class="form-control mt-1" type="text" id="snameEid" required /></label><br>
        <label for="sageRid">Age<br>
          <input class="form-control mt-1" type="number" id="sageEid" required /></label><br>
        <div class=" mt-1">
          <label class="form-label">Gender<br>
            <label for="gmale">Male</label>
            <input class="genderc" type="radio" id="gmale" name="gender" value="Male" required />
            <label for="gfemale">Female</label>
            <input class="genderc" type="radio" id="gfemale" name="gender" value="Female" required />
            <label for="gother">Other</label>
            <input class="genderc" type="radio" id="gother" name="gender" value="Other" required />
          </label>
        </div>
        <label for="upassRId">Password <br>
          <input class="form-control mt-1" type="password" id="upassEid" required /></label><br>
        <h3 class="text-center mt-2"><button class="btn btn-warning rounded border-0" onclick="UserUpdate()"
            type="submit" id="subId">Save
            Changes</button>
        </h3>
        <h7 class="mt-2"><a class="text-decoration-none text-danger" onclick="fetchData()">No changes required!</a></h7>
      </div>
    </div>
  </div>
</body>

</html>
<script>

  // fecth data of user from local storage and call append function
  let userId;
  const urlParams = window.location.href;
  userId = urlParams.split('?')[1];
  $("#editId").hide();
  $("#loginId").show();
  let obj = JSON.parse(localStorage.getItem(userId));
  useridNo = obj.id
  username = obj.user_name;
  name = obj.student_name;
  age = obj.age;
  gender = obj.gender;
  password = obj.password;
  planType = obj.plan_name;
  sDate = obj.starting_Date;
  eDate = obj.ending_Date;
  currentDate = new Date();
  day = Math.round((new Date(eDate) - currentDate) / (1000 * 3600 * 24));
  appendData();

  // Upadate the data and set into the storage and redirected the page
  function UserUpdate() {
    sUname = $('#unameEid').val();
    sName = $("#snameEid").val();
    sAge = $("#sageEid").val();
    sGen = '';
    $.each($("input[name='gender']:checked"), function () {
      sGen += ($(this).val());
    });
    sPass = $("#upassEid").val();
    vadidationUserData();
  };

  // Show the edit form to edit profile 
  function editProfile() {
    $("#editId").show();
    $("#loginId").hide();
    $("#unameEid").val(username);
    $("#snameEid").val(name);
    $("#sageEid").val(age);
    $("#upassEid").val(password);
  };

  // append the data into the html
  function appendData() {
    $("#idnoId").html(useridNo);
    $("#usernameId").html(username);
    $("#nameId").html(name);
    $("#ageId").html(age);
    $("#genderId").html(gender);
    $("#passwordId").html(password);
    if (planType != 'No plan' && day > 0) {
      $("#planId").html(planType);
      $("#plandayId").html('(only ' + day + ' left)');
      $("#notifiactionId").html('<p>*If you not received class material or daily lectures link then kindly contact us</p>');
      $("#contactId").html('<a href="Contact-us.html?' + userId + '">Contact us<a>');
    }
    else {
      $("#planId").html('Currently you have no activated plan');
    }
  };

  //No change after call edit function
  function fetchData() {
    $("#editId").hide();
    $("#loginId").show();
  };

  // Call the home page
  function backHome() {
    window.location.href = 'Home.html?' + userId;
  };

  // validation on user edit their profile
  function vadidationUserData() {
    if (sUname == '') {
      alert('you need to enter user name')
    }
    else if (sName == '') {
      alert('you need to enter your name')
    }
    else if (sAge == '') {
      alert('you need to enter age')
    }
    else if (sGen == '') {
      alert('you need to choose any gender')
    }
    else if (sPass == '') {
      alert('you need to set any password')
    }
    else {
      const data = { id: userId, user_name: sUname, student_name: sName, age: sAge, gender: sGen, password: sPass, plan_name: planType, starting_Date: sDate, ending_Date: eDate };
      localStorage.setItem(userId, JSON.stringify(data));
      window.location.href = 'User.html?' + userId;
    }
  };
</script>